Proposed edit:
client.py
+11
-0
 284
Apply
{{ ... }}
def count_user_clients(user_id):
    """Compte le nombre de clients créés par un utilisateur"""
    return Client.query.filter_by(commercial_id=user_id, archive=False).count()

@client_bp.route('/clients/add', methods=['GET', 'POST'])
@login_required
@role_required('commercial', 'admin', 'superadmin')
def add():
    # Vérifier la limite de clients
    if current_user.role in ['commercial', 'admin']:
        client_count = count_user_clients(current_user.id)
        if client_count >= 3:
            flash('Vous avez atteint la limite de 3 clients. Veuillez contacter un super admin pour en créer davantage.', 'danger')
            return redirect(url_for('client.index'))

    form = ClientForm()
{{ ... }}