Proposed edit:
prestation.py
+11
-0
 981
Apply
{{ ... }}
def count_user_prestations(user_id):
    """Compte le nombre de prestations créées par un utilisateur"""
    return Prestation.query.filter_by(commercial_id=user_id, archive=False).count()

@prestation_bp.route('/add', methods=['GET', 'POST'])
@login_required
def add():
    # Vérifier les permissions
    check_permission()
    
    # Vérifier la limite de prestations
    if current_user.role in ['commercial', 'admin']:
        prestation_count = count_user_prestations(current_user.id)
        if prestation_count >= 3:
            flash('Vous avez atteint la limite de 3 prestations. Vous êtes en mode accès anticipé. Veuillez contacter DSL pour en créer davantage.', 'danger')
            return redirect(url_for('prestation.index'))
    
    form = PrestationForm()
{{ ... }}